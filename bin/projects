#!/bin/zsh

if [[ -f "$HOME/.projectdirs" ]]; then
    cmd="cat $HOME/.projectdirs 2>/dev/null"
else
    #    read all dirs              rem. empty l.    rem. first l.    rem. last l.    prepend $HOME to found dirs
    cmd="tree $HOME -d -L 1 -i -a | sed '/^$/d' |    sed '/\\//D' |   sed '$ D'     | sed \"s#^#`echo $HOME`/#\" "
fi

choice="zsh"
lst=`eval $cmd | awk '{print "\\\\\""$0"\\\\\""}' | xargs` #<-- surround each line in " to handled dirs with spaces

while [[ "$choice" != "" ]]; do

	cmd="parallel -j4 -i find {} -iname workspace.tmux -- $lst"
	choice=`eval $cmd | fzf`
    #choice=`eval $cmd | parallel -j 3 "find {} -name 'workspace.tmux' 2>/dev/null" | fzf &`

    if [[ "$choice" == "" ]]; then
        break;
    else
		echo $choice;
        echo $choice | run && tmux attach 2>/dev/null
    fi

done
# find $($cmd | xargs) -type f -name 'workspace.tmux' 2>/dev/null | fzf | run && tmux attach
