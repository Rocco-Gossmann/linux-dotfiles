#!/bin/zsh

if [[ -f "$HOME/.projectdirs" ]]; then
    cmd="cat $HOME/.projectdirs 2>/dev/null"
else
    #    read all dirs              rem. empty l.    rem. first l.    rem. last l.    prepend $HOME to found dirs
	cmd="ls -Ndm1 */"	
fi

choice="zsh"
lst=`eval $cmd | awk '{print "\\\\\""$0"\\\\\""}' | xargs` #<-- surround each line in " to handled dirs with spaces

while [[ "$choice" != "" ]]; do

	cmd="parallel -i find {} -iname workspace.tmux -- $lst"
	#echo $cmd
	choice=`eval $cmd | fzf`

    if [[ "$choice" == "" ]]; then
        break;
    else
		echo $choice;
        echo "$choice" | run && tmux attach 2>/dev/null
    fi

done
